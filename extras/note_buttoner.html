<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Notes Object Builder (extra/dark/blue/red/green/orange/yellow/purple)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root {
    --bg:#ffffff; --card:#ffffff; --text:#111; --muted:#555;
    --border:#ddd; --primary:#1f6feb; --primary-dark:#1b5fd1;
  }
  * { box-sizing: border-box; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--text); margin: 20px; }
  h1 { font-size: 20px; margin: 0 0 12px; }
  h2 { font-size: 16px; margin: 0 0 8px; }
  .muted { color: var(--muted); font-size:12px }
  .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px; }
  .card { border:1px solid var(--border); border-radius:10px; background:var(--card); padding:12px; }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  textarea { width: 100%; min-height: 120px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 13px; padding: 8px; border-radius: 8px; border:1px solid var(--border); }
  input[type="text"] { width: 100%; font-size: 13px; padding: 8px; border-radius: 8px; border:1px solid var(--border);}
  .btn { padding: 8px 12px; border:1px solid var(--border); background:#f6f6f6; border-radius:8px; cursor:pointer; }
  .btn.primary { background: var(--primary); color:#fff; border-color: var(--primary-dark); }
  .btn.warn { background:#fff7ed; border-color:#fdba74; }
  .btn:active { transform: translateY(1px); }
  pre { background:#0f172a; color:#e5e7eb; padding:12px; border-radius:8px; overflow:auto; font-size:12px; white-space:pre; }
  .k { font-weight:600; }
  .tagline { margin: 6px 0 0; }
  .pill { font-size: 11px; padding: 2px 6px; border-radius: 999px; border:1px solid var(--border); background:#fafafa; }
  .footer { margin-top: 12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
  .count { font-variant-numeric: tabular-nums; }
</style>
</head>
<body>
<h1>Notes Object Builder</h1>
<p class="muted tagline">Enter comma/newline separated items for each colour group. Use <span class="pill">Normalise</span> to trim and deduplicate while preserving order.</p>

<div class="card">
  <h2>Import existing <code>notes</code> (optional)</h2>
  <textarea id="importBox" placeholder='Paste an existing object, e.g.:
{
  "extra": ["Correlate","Flag"],
  "dark": ["Observe"]
}'></textarea>
  <div class="footer">
    <button class="btn" id="importBtn">Load from object</button>
    <button class="btn warn" id="resetBtn">Reset all fields</button>
    <span id="importInfo" class="muted"></span>
  </div>
</div>

<div class="grid" id="editGrid">
  <!-- Sections generated by JS -->
</div>

<div class="card">
  <div class="row" style="justify-content: space-between;">
    <h2>Output</h2>
    <div class="muted">Items total: <span id="totCount" class="count">0</span></div>
  </div>
  <div class="row" style="margin:0 0 8px;">
    <button class="btn" id="normaliseBtn">Normalise</button>
    <button class="btn primary" id="buildBtn">Build object</button>
    <button class="btn" id="copyBtn">Copy</button>
    <button class="btn" id="downloadBtn">Download .js</button>
    <span id="info" class="muted"></span>
  </div>
  <pre id="codeOut" spellcheck="false"></pre>
</div>

<script>
(function(){
  "use strict";

  // ----- Configuration: categories and their initial contents -----
  const MODEL = {
    extra: ['Correlate', 'Flag', 'Now', 'Then', 'Next', 'Last', 'Changes', 'Note', 'Context', 'Associate', 'Plan', 'Review', 'Hindsight', 'Redose', 'Hit', 'Continue', 'Food', 'Drink', 'Sleep', 'LastRow', 'LastDose', 'LastHit', 'Single', 'Multiple', 'DrugAdded', 'NothingAdded', 'UsingRemains', 'LeftRemains', 'MaybeUsable', 'LotsUsable', 'Weighed', 'Eyeballed', 'Guessed', 'Estimate', 'Scales', 'HardToSee', 'LightRoom', 'DarkRoom', 'Less', 'More', 'Somewhat', 'Lots'],
    dark: [ 'Observe', 'Follow', 'Adaptive', 'Rock', 'Fast', 'Slowly', 'Roll', 'Rapid', 'Spin', 'SideToSide', 'CoatBowl', 'LargeRoll', 'SmallRoll', 'ManyHits', 'OneHit', 'MeltFirst', 'Burned', 'SuddenDrop'],
    blue: ['Plumes', 'Billowing', 'Vapour', 'Visible', 'Invisible', 'LotsOfVapour', 'SoftVapour', 'ThickVapour', 'WarmAir', 'BackPressure', 'Smoke', 'HalfBurned', 'NiceSmell', 'NiceTaste', 'Irritant', 'Pressure', 'Ignition', 'BurnedSmell', 'DarkVapour'],
    red: ['Minor', 'Some', 'Slight', 'SideEffects', 'WideEyes', 'Headache', 'Heartbeat', 'HeartPounding', 'BloodPressure', 'TempIncrease', 'TempDecrease', 'Visceral', 'Feel',  'Chills', 'Sweat', 'Tremor', 'Shakes', 'Nausea', 'AfterEffects', 'DayAfter', 'Hangover', 'JustWoke', 'MorningAfter', 'EarsRinging', 'ChestPain'],
    green: [ '555Hold', 'DeepBreath', 'ShallowBreath', 'Diaphragm', 'HoldBreath', 'MultipleBreath', 'Sucked', 'SuckedHard', 'Gentle', 'Aggressive', 'OneBreath', 'LipSeal', 'HalfSealed', 'NotSealed', 'MouthOpen', 'ThroatBreath', 'Irritant','SuctionDistance', 'HighHeat', 'LowHeat'],
    orange: [ 'Cone', 'Snowcone', 'Metal', 'Glass', 'Pipe', 'Line', 'Sniff', 'Rectal', 'Inject', 'Oral', 'Sublingual', 'Lighter', 'Jet', 'Blowtorch', 'Broken', 'Clean', 'New', 'Dirty', 'Rinsed', 'Scraped', 'Dried', 'Wet', 'Dry', 'Weathered', 'Soaked', 'Damp', 'WasWet', 'HasDried', 'Loose', 'Moving', 'NotMoving', 'Runny', 'Chunk', 'Paste', 'Rock', 'Sludge', 'Crushed', 'NotCrushed', 'Powder', 'Granules', 'Crystal', 'Crystalline', 'Dust', 'Liquid', 'WaterWeighted', 'PropyleneGlycol', 'Water','VapourWait', 'VapourPool', 'PowderIgnites'],
    yellow: ['Positive', 'Negative', 'Neither', 'Flat', 'Unknown', 'Melted', 'Burned', 'ColourChange', 'StateChange', 'Melt', 'Burn', 'Audible', 'Carbon', 'Thin', 'Film', 'Fun', 'Analytics', 'Comparative', 'Relative', 'Absolute', 'Observe'],
    purple: ['Male', 'Female', 'Others', 'Home', 'Alone', 'Downstairs', 'Upstairs', 'RoomAlone', 'NotAlone', 'BuildingAlone', 'BuildingNotAlone', 'GoingToBed', 'UnsupportiveNear', 'Thirsty', 'Hungry', 'HungerPains', 'AlreadyHadSome', 'Weed', 'Tobacco', 'Spin', 'Mix', 'Edible', 'MusicPlaying', 'MusicOff', 'NotEating', 'NotDrinking', 'Neglecting', 'AwareOfChoices', 'BadChoices', '2MMC', '3MMC','4MMC', 'Meth', 'Cocaine', 'Crack', 'MDPIHP', '2MEPIHP', 'Claimed', 'NoAlcohol', 'Alcohol', 'AlcoholAffected', 'Drunk', 'Stoned']
  };

  // ----- DOM helpers -----
  const $ = (s, el=document) => el.querySelector(s);
  const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));

  // ----- Create edit tiles -----
  const grid = $("#editGrid");

  const TITLE = {
    extra:"extra", dark:"dark", blue:"blue", red:"red",
    green:"green", orange:"orange", yellow:"yellow", purple:"purple"
  };

  function createSection(key, values){
    const card = document.createElement("div");
    card.className = "card";

    const countId = `count_${key}`;
    const taId = `ta_${key}`;

    card.innerHTML = `
      <div class="row" style="justify-content:space-between;align-items:baseline;">
        <h2><span class="k">${key}</span></h2>
        <span class="muted">Count: <span id="${countId}" class="count">0</span></span>
      </div>
      <textarea id="${taId}" aria-label="${key} items" placeholder="Comma or newline separated list"></textarea>
      <div class="footer">
        <button class="btn" data-act="normalise" data-key="${key}">Normalise</button>
        <button class="btn" data-act="sort" data-key="${key}">Sort A→Z</button>
        <button class="btn warn" data-act="clear" data-key="${key}">Clear</button>
      </div>
    `;
    grid.appendChild(card);

    const ta = $("#"+taId, card);
    ta.value = values.join(", ");
    updateCount(key);
    ta.addEventListener("input", ()=>updateCount(key));
  }

  Object.entries(MODEL).forEach(([k,v])=>createSection(k,v));

  // ----- Normalisation / parsing -----
  function splitItems(raw){
    // Split by comma or newline; trim, collapse inner whitespace; drop empties
    return String(raw||"")
      .split(/[\n,]/g)
      .map(s => s.trim().replace(/\s+/g, " "))
      .filter(s => s.length>0);
  }

  function dedupePreserveOrder(items){
    const seen = new Set();
    const out = [];
    for(const x of items){
      const key = x; // case-sensitive by design
      if(!seen.has(key)){
        seen.add(key);
        out.push(x);
      }
    }
    return out;
  }

  function normaliseField(key){
    const ta = $("#ta_"+key);
    const norm = dedupePreserveOrder(splitItems(ta.value));
    ta.value = norm.join(", ");
    updateCount(key);
  }

  function updateCount(key){
    const ta = $("#ta_"+key);
    const n = splitItems(ta.value).length;
    $("#count_"+key).textContent = n;
    updateTotals();
  }

  function updateTotals(){
    const total = Object.keys(MODEL).reduce((acc,k)=> acc + splitItems($("#ta_"+k).value).length, 0);
    $("#totCount").textContent = String(total);
  }

  // ----- Build output -----
  function quote(str){
    return "'" + String(str).replace(/\\/g,"\\\\").replace(/'/g,"\\'") + "'";
  }

  function buildNotesObject(){
    const out = {};
    for(const k of Object.keys(MODEL)){
      out[k] = splitItems($("#ta_"+k).value);
    }
    const lines = ["const notes = {"];
    for(const [k,arr] of Object.entries(out)){
      const items = arr.map(quote).join(", ");
      lines.push(`  ${k}: [${items}],`);
    }
    lines.push("};");
    return lines.join("\n");
  }

  // ----- Actions -----
  $("#normaliseBtn").addEventListener("click", ()=>{
    Object.keys(MODEL).forEach(normaliseField);
    $("#info").textContent = "Normalised all groups (trimmed + deduplicated; order preserved).";
  });

  $("#buildBtn").addEventListener("click", ()=>{
    const code = buildNotesObject();
    $("#codeOut").textContent = code;
    $("#info").textContent = "Built object.";
  });

  $("#copyBtn").addEventListener("click", async ()=>{
    try{
      const text = $("#codeOut").textContent;
      if(!text.trim()){ alert("Build the object first."); return; }
      await navigator.clipboard.writeText(text);
      $("#info").textContent = "Copied to clipboard.";
    }catch(e){
      alert("Copy failed.");
    }
  });

  $("#downloadBtn").addEventListener("click", ()=>{
    const text = $("#codeOut").textContent;
    if(!text.trim()){ alert("Build the object first."); return; }
    const blob = new Blob([text], {type:"application/javascript"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "notes.js";
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
    $("#info").textContent = "Downloaded notes.js.";
  });

  grid.addEventListener("click", (ev)=>{
    const btn = ev.target.closest("button[data-act]");
    if(!btn) return;
    const act = btn.getAttribute("data-act");
    const key = btn.getAttribute("data-key");
    const ta = $("#ta_"+key);
    if(act==="normalise"){
      normaliseField(key);
      $("#info").textContent = `Normalised “${key}”.`;
    }else if(act==="sort"){
      const items = splitItems(ta.value).sort((a,b)=>a.localeCompare(b));
      ta.value = items.join(", ");
      updateCount(key);
      $("#info").textContent = `Sorted “${key}” A→Z.`;
    }else if(act==="clear"){
      ta.value = "";
      updateCount(key);
      $("#info").textContent = `Cleared “${key}”.`;
    }
  });

  // ----- Import / Reset -----
  $("#importBtn").addEventListener("click", ()=>{
    const raw = $("#importBox").value.trim();
    if(!raw){ alert("Paste an existing notes object first."); return; }
    let obj = null;
    try{
      // Accept either strict JSON or a JS-like object (single quotes, trailing commas)
      const jsonish = raw
        .replace(/(\w+)\s*:/g, '"$1":')     // unquoted keys -> quoted
        .replace(/'/g, '"');                 // single quotes -> double
      obj = JSON.parse(jsonish);
    }catch(e){
      alert("Could not parse the pasted object. Ensure it resembles JSON.");
      return;
    }
    const groups = Object.keys(MODEL);
    let filled = 0;
    for(const k of groups){
      const v = obj[k];
      if(Array.isArray(v)){
        $("#ta_"+k).value = v.map(x=>String(x)).join(", ");
        normaliseField(k);
        filled++;
      }
    }
    $("#importInfo").textContent = `Loaded ${filled}/${groups.length} groups from input.`;
    $("#info").textContent = "Imported values. Consider Normalise and Build.";
  });

  $("#resetBtn").addEventListener("click", ()=>{
    Object.entries(MODEL).forEach(([k,v])=>{
      $("#ta_"+k).value = "";
      updateCount(k);
    });
    $("#importBox").value = "";
    $("#codeOut").textContent = "";
    $("#info").textContent = "Reset all fields.";
    $("#importInfo").textContent = "";
  });

  // Build once on load to show initial model
  (function bootstrap(){
    // Seed textareas with MODEL is already done in createSection.
    // Compute totals and render initial output for convenience.
    $("#buildBtn").click();
  })();

})();
</script>
</body>
</html>